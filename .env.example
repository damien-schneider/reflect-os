# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║                         MONOREPO ENVIRONMENT SETUP                         ║
# ║                                                                            ║
# ║  Copy to `.env` in the REPOSITORY ROOT (never commit `.env`)               ║
# ║  Both apps/backend and apps/web load from this single file.                ║
# ║  Generate secrets: `openssl rand -base64 32`                               ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

# =============================================================================
# DATABASE (Required)
# =============================================================================
# PostgreSQL connection string
# - Development: Docker on port 5430
# - Production: Set in docker-compose environment or Dokploy
ZERO_UPSTREAM_DB="postgresql://user:password@127.0.0.1:5430/postgres"

# Local replica file for Zero (SQLite cache)
ZERO_REPLICA_FILE="/tmp/reflect_zero_replica.db"

# Log level: debug|info|warn|error
ZERO_LOG_LEVEL="debug"

# =============================================================================
# AUTHENTICATION (Required)
# =============================================================================
# Better Auth secret - used to sign session cookies
# IMPORTANT: Use 32+ characters in production!
BETTER_AUTH_SECRET="GENERATE_32+_CHARS_FOR_PRODUCTION"

# Your app's public URL (used for OAuth callbacks, email links)
# - Development: http://localhost:5173
# - Production: https://yourdomain.com
BETTER_AUTH_URL="http://localhost:5173"

# Zero authentication secret (for server-to-server communication)
# Can be the same as BETTER_AUTH_SECRET in simple setups
ZERO_AUTH_SECRET="GENERATE_32+_CHARS_FOR_PRODUCTION"

# Zero cookie-based auth (recommended for Zero 0.25+)
ZERO_QUERY_FORWARD_COOKIES="true"
ZERO_MUTATE_FORWARD_COOKIES="true"

# Zero custom endpoints (for named queries and mutators)
# These URLs must be accessible from zero-cache
# In dev: frontend origin (Vite proxies /api to backend)
# In prod: your API server URL
ZERO_MUTATE_URL="http://localhost:5173/api/zero/mutate"
ZERO_QUERY_URL="http://localhost:5173/api/zero/query"

# =============================================================================
# FRONTEND (Required)
# =============================================================================
# Zero cache server URL (browser WebSocket connection)
# - Development: http://localhost:4848
# - Production: https://zero.yourdomain.com
VITE_PUBLIC_ZERO_SERVER="http://localhost:4848"

# Internal API URL for server-side calls (within Docker network)
# - Development: http://localhost:3001
# - Production Docker: http://backend:3001
INTERNAL_API_URL="http://localhost:3001"

# =============================================================================
# EMAIL - RESEND (Optional)
# =============================================================================
# When NOT configured:
# - Email verification is disabled (users auto-verified on signup)
# - Password reset URLs are logged to console
# - Invitation URLs are logged to console
#
# To enable email:
# 1. Create account at https://resend.com
# 2. Add and verify your domain
# 3. Create API key and paste below
# =============================================================================
RESEND_API_KEY=""

# Sender information (requires verified domain for custom address)
EMAIL_FROM_ADDRESS="onboarding@resend.dev"
EMAIL_FROM_NAME="Reflet"

# Require email verification for signups
# Set to "true" only if RESEND_API_KEY is configured
VITE_PUBLIC_REQUIRE_EMAIL_VERIFICATION="false"

# =============================================================================
# BILLING - POLAR (Optional)
# =============================================================================
# When NOT configured:
# - App runs in "free tier only" mode
# - No subscription management or checkout
# - Build validation skipped for Polar
#
# To enable billing:
# 1. Create account at https://polar.sh
# 2. Create products matching your tiers (see SUBSCRIPTION TIERS section below)
# 3. Create access token and paste below
# 4. Set up webhooks (see WEBHOOKS section in README)
# =============================================================================

# Environment: sandbox (testing) or production (live)
POLAR_ENVIRONMENT="sandbox"

# Access token from https://polar.sh/settings/tokens
POLAR_ACCESS_TOKEN=""

# Webhook secret from Polar webhook settings
# Required for processing subscription events
POLAR_WEBHOOK_SECRET=""

# =============================================================================
# SUBSCRIPTION TIERS (Polar Product Naming)
# =============================================================================
# When POLAR_ACCESS_TOKEN is set, build validation ensures these products exist:
#
#   Required Products (create in Polar Dashboard):
#   ├── Pro Monthly
#   ├── Pro Yearly
#   ├── Team Monthly
#   └── Team Yearly
#
# Product names must include the tier name ("Pro" or "Team") and billing
# interval ("Monthly" or "Yearly"). Case-insensitive matching.
#
# To add more tiers, edit: packages/polar/src/tiers.ts
# =============================================================================

# =============================================================================
# DRIZZLE GATEWAY (Optional)
# =============================================================================
# Master password for Drizzle Gateway web UI
# Access database at https://drizzle.yourdomain.com
MASTERPASS="defaultdevpassword"

# =============================================================================
# DEVELOPMENT FLAGS
# =============================================================================
# Allow signup without email verification in development
DEV_AUTH_ALLOW_UNVERIFIED_SIGNUP="true"

# Skip Polar product validation during build (for CI without tokens)
# POLAR_SKIP_VALIDATION="true"

# =============================================================================
# PRODUCTION ENVIRONMENT (docker-compose.yaml)
# =============================================================================
# These are set in docker-compose.yaml or Dokploy UI, not in .env:
#
# POSTGRES_USER="reflect_user"          # Database user (avoid 'postgres')
# POSTGRES_PASSWORD="CHANGE_ME"         # Strong database password
# PUBLIC_URL="https://yourdomain.com"   # Your app's public URL
# ZERO_SERVER_URL="https://zero.yourdomain.com"  # Zero cache public URL
# ZERO_ADMIN_PASSWORD="CHANGE_ME"       # Zero cache admin password
# ZERO_NUM_SYNC_WORKERS="2"             # Number of sync workers
